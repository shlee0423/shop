<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.korea.mapper.ProductMapper">
    <resultMap id="selectProductWithImage" type="ProductDTO" autoMapping="true">
        <id property="no" column="product_no" />
        <collection property="images" ofType="FileDTO" javaType="list" autoMapping="true">
            <id property="UUID" column="image_no" />
        </collection>
    </resultMap>

    <select id="selectProductByNo" resultType="ProductDTO" resultMap="selectProductWithImage">
        SELECT
            P.`no` AS 'product_no',
            PI.`no` AS 'image_no',
            P.*, PI.*
        FROM `product` P
            INNER JOIN `product_img` PI
            ON `P`.`no` = `PI`.`product_no`
        WHERE P.`no` = #{no}
    </select>
    <select id="selectProducts" resultType="ProductDTO" resultMap="selectProductWithImage">
        SELECT
            P.`no` AS 'product_no',
            PI.`no` AS 'image_no',
            P.*, PI.*
        FROM `product` P
            INNER JOIN `product_img` PI
            ON `P`.`no` = `PI`.`product_no`
        LIMIT 60
    </select>
</mapper>